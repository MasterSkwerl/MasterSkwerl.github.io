<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="https://unpkg.com/@atlaskit/css-reset@2.0.0/dist/bundle.css" media="all">
        <script src="https://connect-cdn.atl-paas.net/all.js"></script>
    </head>
    <body>
        <section id="content" class="ac-content">

            <div id="tableData">Starting Content</div>



<script type="text/javascript">

AP.events.on('ISSUE_GLANCE_OPENED', function() {
    AP.context.getContext(function(response){
        console.log("Jira Issue Key", response.jira.issue.key);
        issueKey = response.jira.issue.key;
        GetIssueData(issueKey);
    });
  });

function GetIssueData(issueKey){
    AP.request(`/rest/api/3/issue/${issueKey}`)
    .then(data => {
        var issue = data.body;
        console.log("Jira Fields", issue);
        var jsonObject = (new Function("return " + data.body))();
        GetReporterData(jsonObject.fields.reporter.accountId);
    })
    .catch(e => alert(e.err));
}

function GetReporterData(accountId){
    AP.request(`/rest/api/3/user?accountId=${accountId}`)
    .then(data => {
        console.log("Jira Reporter Data", data.body);
        GetExtendedUserInfo(accountId);
    })
    .catch(e => alert(e.err));
}

function GetExtendedUserInfo(accountId){
    var propertyKey = "custom";
    AP.request(`/rest/api/3/user/properties/${propertyKey}?accountId=${accountId}`)
    .then(data => {
        console.log("Extended User Data", data.body);
        CreateTableFromJSON();
    })
    .catch(e => alert(e.err));
}

function CreateTableFromJSON(){
    console.log("Beginning Table Creation");

    var jsonObject = JSON.parse('{"key":"custom","value":{"company":"unlocked","vip":"true"}}');

    console.log("Json Object", jsonObject);
    console.log("Json Object Values", jsonObject.value);
    
    // var table = document.createElement("table");

    // console.log("Beginning to Parse Keys")

    // for (let [key, value] of Object.entries(jsonObject.value)) {
        
    //     console.log(`${key}: ${value}`);

    //     tr = table.insertRow(-1);

    //     var headerCell = tr.insertCell(-1);
    //     headerCell.innerHTML = key;

    //     var valueCell = tr.insertCell(-1);
    //     valueCell.innerHTML = value;
    // }

    console.log("Attempting to Add Table to DIV");

    var divContainer = document.getElementById("tableData");

    console.log("Original Content: ", divContainer.innerHTML);


    divContainer.innerHTML = `
    <table class="aui">
    <thead>
        <tr>
            <th id="name">Name</th>
            <th id="type">Type</th>
            <th id="order">Order</th>
            <th id="action">Action</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td headers="name">Default</td>
            <td headers="type">Internal Directory</td>
            <td class="order" headers="order">
                <ul class="menu">
                    <li>
                        <a class="down" href="#">Down</a>
                    </li>
                </ul>
            </td>
            <td class="action" headers="action">
                <ul class="menu">
                    <li>
                        <a href="#">An Action</a>
                    </li>
                </ul>
            </td>
        </tr>
        <tr>
            <td headers="name">Corporate LDAP</td>
            <td headers="type">Microsoft Active Directory</td>
            <td class="order" headers="order">
                <ul class="menu">
                    <li>
                        <a class="up" href="#">Up</a>
                    </li>
                    <li>
                        <a class="down" href="#">Down</a>
                    </li>
                </ul>
            </td>
            <td class="action" headers="action">
                <ul class="menu">
                    <li>
                        <a href="#">An Action</a>
                    </li>
                    <li>
                        <a href="#">Another Action</a>
                    </li>
                </ul>
            </td>
        </tr>
    </tbody>
</table>
    `;
    //divContainer.appendChild(table);
}



</script>

        </section>
    </body>
</html>
